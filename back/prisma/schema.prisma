// Configuração do banco
datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// MODELOS

model Usuario {
  id           Int          @id @default(autoincrement())
  nome         String       @db.VarChar(100)
  telefone     String       @unique @db.VarChar(15)
  morada       String       @db.VarChar(255)
  senhaHash    String       @db.VarChar(255)
  email        String       @unique @db.VarChar(100)
  perfil       String       @db.VarChar(20) // 'ADMIN', 'CIDADÃO', 'COMERCIANTE'
  pagamentos   Pagamento[]
  auditorias   Auditoria[]
  criadoEm     DateTime     @default(now())
}

model Taxa {
  id            Int          @id @default(autoincrement())
  nome          String       @db.VarChar(100)
  valor         Decimal      @db.Decimal(10,2)
  periodicidade String       @db.VarChar(20) // 'DIÁRIA', 'MENSAL', 'ANUAL'
  ativo         Boolean?     @default(true)
  pagamentos    Pagamento[]
}

model Pagamento {
  id           Int          @id @default(autoincrement())
  usuarioId    Int
  taxaId       Int
  valorPago    Decimal      @db.Decimal(10,2)
  metodo       String       @db.VarChar(20) // 'M-PESA', 'E-MOLA', 'CASH'
  data         DateTime     @default(now())
  status       String       @db.VarChar(15) // 'PAGO', 'PENDENTE'
  usuario      Usuario      @relation(fields: [usuarioId], references: [id])
  taxa         Taxa         @relation(fields: [taxaId], references: [id])
}

model Auditoria {
  id           Int          @id @default(autoincrement())
  acao         String       @db.VarChar(100)
  entidade     String       @db.VarChar(50)
  userId       Int
  dataRegistro DateTime     @default(now())
  detalhes     String?      @db.Text
  usuario      Usuario      @relation(fields: [userId], references: [id])
}
